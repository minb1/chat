<!DOCTYPE html>
<html lang="en">
<head>
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <meta content="text/html; charset=utf-8" http-equiv="content-type">
    <meta name="generator" content="ReSpec 35.2.2">
    <title>NLGov REST API Design Rules 2.0.2</title>

    <!-- Original Styles -->
    <style>
        .issue-label{text-transform:initial}
        .warning>p:first-child{margin-top:0}
        .warning{padding:.5em;border-left-width:.5em;border-left-style:solid}
        span.warning{padding:.1em .5em .15em}
        .issue.closed span.issue-number{text-decoration:line-through}
        .issue.closed span.issue-number::after{content:" (Closed)";font-size:smaller}
        .warning{border-color:#f11;border-color:var(--warning-border,#f11);border-width:.2em;border-style:solid;background:#fbe9e9;background:var(--warning-bg,#fbe9e9);color:#000;color:var(--text,#000)}
        .warning-title:before{content:"âš ";font-size:1.3em;float:left;padding-right:.3em;margin-top:-.3em}
        li.task-list-item{list-style:none}
        input.task-list-item-checkbox{margin:0 .35em .25em -1.6em;vertical-align:middle}
        .issue a.respec-gh-label{padding:5px;margin:0 2px 0 2px;font-size:10px;text-transform:none;text-decoration:none;font-weight:700;border-radius:4px;position:relative;bottom:2px;border:none;display:inline-block}
    </style>
    <style>
        dfn{cursor:pointer}
        .dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font-family:"Helvetica Neue",sans-serif;font-size:small;background:#fff;background:var(--indextable-hover-bg,#fff);color:#000;color:var(--text,#000);box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);box-shadow:0 1em 3em -.4em var(--tocsidebar-shadow,rgba(0,0,0,.3)),0 0 1px 1px var(--tocsidebar-shadow,rgba(0,0,0,.05));border-radius:2px}
        .dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
        .dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;border-bottom-color:var(--indextable-hover-bg,#fff);top:0}
        .dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1;border-bottom-color:var(--indextable-hover-bg,#a2a9b1)}
        .dfn-panel *{margin:0}
        .dfn-panel b{display:block;color:#000;color:var(--text,#000);margin-top:.25em}
        .dfn-panel ul a[href]{color:#333;color:var(--text,#333)}
        .dfn-panel>div{display:flex}
        .dfn-panel a.self-link{font-weight:700;margin-right:auto}
        .dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
        .dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
        .dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
        .dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
        .dfn-panel a[href]:hover{border-bottom-width:1px}
        .dfn-panel ul{padding:0}
        .dfn-panel li{margin-left:1em}
        .dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
    </style>
    <link href="./media/style.css" rel="stylesheet" type="text/css">
    <link href="https://gitdocumentatie.logius.nl/publicatie/respec/style/logos/logius.ico" rel="shortcut icon" type="image/x-icon">
    <style id="respec-mainstyle">
        @keyframes pop{
        0%{transform:scale(1,1)}
        25%{transform:scale(1.25,1.25);opacity:.75}
        100%{transform:scale(1,1)}
        }
        a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
        a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
        a.bibref{text-decoration:none}
        .respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
        .respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
        @supports not (text-decoration:red wavy underline){
        .respec-offending-element:not(pre){display:inline-block}
        .respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
        }
        #references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
        cite .bibref{font-style:normal}
        a[href].orcid{padding-left:4px;padding-right:4px}
        a[href].orcid>svg{margin-bottom:-2px}
        ol.tof,ul.tof{list-style:none outside none}
        .caption{margin-top:.5em;font-style:italic}
        #issue-summary>ul{column-count:2}
        #issue-summary li{list-style:none;display:inline-block}
        details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
        details.respec-tests-details>*{padding-right:2em}
        details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
        details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
        details.respec-tests-details>ul{width:100%;margin-top:-.3em}
        details.respec-tests-details>li{padding-left:1em}
        .self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
        aside.example .marker>a.self-link{color:inherit}
        .header-wrapper{display:flex;align-items:baseline;position:relative;left:-.5em}
        :is(h2,h3,h4,h5,h6):not(#toch2)+a.self-link{color:inherit;order:-1;position:relative;left:-.7em;font-size:1rem;opacity:.5}
        :is(h2,h3,h4,h5,h6)+a.self-link::before{content:"Â§";text-decoration:none;color:var(--heading-text)}
        :is(h2,h3)+a.self-link{top:-.2em}
        :is(h4,h5,h6)+a.self-link::before{color:#000}
        @media (max-width:767px){
        dd{margin-left:0}
        }
        @media print{
        .removeOnSave{display:none}
        }
    </style>
    <style id="respec-nlgov">
        img.license{float:left;padding-right:5px}
    </style>
    <meta name="color-scheme" content="light">
    <meta name="description" content="This document contains a normative standard for designing APIs in the Dutch Public Sector.
The Governance of this standard is described by the API-Standaarden beheermodel in a separate repository and published by Logius.
This document is part of the Nederlandse API Strategie, which consists of a set of documents.">
    <style>
        .hljs{--base:#fafafa;--mono-1:#383a42;--mono-2:#686b77;--mono-3:#717277;--hue-1:#0b76c5;--hue-2:#336ae3;--hue-3:#a626a4;--hue-4:#42803c;--hue-5:#ca4706;--hue-5-2:#c91243;--hue-6:#986801;--hue-6-2:#9a6a01}
        @media (prefers-color-scheme:dark){
        .hljs{--base:#282c34;--mono-1:#abb2bf;--mono-2:#818896;--mono-3:#5c6370;--hue-1:#56b6c2;--hue-2:#61aeee;--hue-3:#c678dd;--hue-4:#98c379;--hue-5:#e06c75;--hue-5-2:#be5046;--hue-6:#d19a66;--hue-6-2:#e6c07b}
        }
        .hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;color:var(--mono-1,#383a42);background:#fafafa;background:var(--base,#fafafa)}
        .hljs-comment,.hljs-quote{color:#717277;color:var(--mono-3,#717277);font-style:italic}
        .hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4;color:var(--hue-3,#a626a4)}
        .hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#ca4706;color:var(--hue-5,#ca4706);font-weight:700}
        .hljs-literal{color:#0b76c5;color:var(--hue-1,#0b76c5)}
        .hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#42803c;color:var(--hue-4,#42803c)}
        .hljs-built_in,.hljs-class .hljs-title{color:#9a6a01;color:var(--hue-6-2,#9a6a01)}
        .hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801;color:var(--hue-6,#986801)}
        .hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#336ae3;color:var(--hue-2,#336ae3)}
        .hljs-emphasis{font-style:italic}
        .hljs-strong{font-weight:700}
        .hljs-link{text-decoration:underline}
    </style>
    <style>
        .sidelabel {
            position: fixed;
            -webkit-transform-origin: top right;
            right: 100%;
            top: 0;
            -webkit-transform: rotate(-90deg);
            padding: 4px 50px 4px 10px;
            color: white;
            white-space: nowrap;
            z-index: 1;
            background-color: #154273; /* Logius Blue */
        }
    </style>
    <script id="initialUserConfig" type="application/json">{
        "nl_organisationName": "Logius",
        "nl_organisationStylesURL": "https://gitdocumentatie.logius.nl/publicatie/respec/style/",
        "nl_organisationPublishURL": "https://gitdocumentatie.logius.nl/publicatie/",
        "logos": [
            {
            "src": "https://gitdocumentatie.logius.nl/publicatie/respec/style/logos/figure-logius.svg",
            "alt": "Logius",
            "id": "Logius",
            "height": 77,
            "width": 44,
            "url": "https://www.logius.nl/onze-dienstverlening/standaarden"
            }
        ],
        "latestVersion": [
            "nl_organisationPublishURL",
            "pubDomain",
            "/",
            "shortName",
            "/"
        ],
        "thisVersion": [
            "nl_organisationPublishURL",
            "pubDomain",
            "/",
            "shortName",
            "/",
            "publishVersion",
            "/"
        ],
        "prevVersion": [
            "nl_organisationPublishURL",
            "pubDomain",
            "/",
            "shortName",
            "/",
            "previousPublishVersion",
            "/"
        ],
        "useLogo": true,
        "useLabel": true,
        "license": "cc-by",
        "addSectionLinks": true,
        "localizationStrings": {
            "en": {
            "wv": "Draft",
            "cv": "Consultation version",
            "vv": "Proposed version",
            "def": "Definitive version",
            "basis": "Document",
            "eo": "Outdated version",
            "tg": "Rescinded version",
            "no": "Norm",
            "st": "Standard",
            "im": "Information model",
            "pr": "Guideline",
            "hr": "Guide",
            "wa": "Proposed recommendation",
            "al": "General",
            "bd": "Governance documentation",
            "bp": "Best practice"
            },
            "nl": {
            "wv": "Werkversie",
            "cv": "Consultatieversie",
            "vv": "Versie ter vaststelling",
            "def": "Vastgestelde versie",
            "basis": "Document",
            "eo": "Verouderde versie",
            "tg": "Teruggetrokken versie",
            "no": "Norm",
            "st": "Standaard",
            "im": "Informatiemodel",
            "pr": "Praktijkrichtlijn",
            "hr": "Handreiking",
            "wa": "Werkafspraak",
            "al": "Algemeen",
            "bd": "Beheerdocumentatie",
            "bp": "Best practice"
            }
        },
        "sotdText": {
            "nl": {
            "sotd": "Status van dit document",
            "def": "Dit is de definitieve versie van dit document. Wijzigingen naar aanleiding van consultaties zijn doorgevoerd.",
            "wv": "Dit is een werkversie die op elk moment kan worden gewijzigd, verwijderd of vervangen door andere documenten. Het is geen door het TO goedgekeurde consultatieversie.",
            "cv": "Dit is een door het TO goedgekeurde consultatieversie. Commentaar over dit document kan gestuurd worden naar digikoppeling@logius.nl",
            "vv": "Dit is een definitief concept van de nieuwe versie van dit document. Wijzigingen naar aanleiding van consultaties zijn doorgevoerd.",
            "basis": "Dit is een document zonder officiÃ«le status."
            },
            "en": {
            "sotd": "Status of This Document",
            "def": "This is the definitive version of this document. Edits resulting from consultations have been applied.",
            "wv": "This is a draft that could be altered, removed or replaced by other documents. It is not a recommendation approved by TO.",
            "cv": "This is a proposed recommendation approved by TO. Comments regarding this document may be sent to api@logius.nl",
            "vv": "This is the definitive concept of this document. Edits resulting from consultations have been applied.",
            "basis": "This document has no official standing."
            }
        },
        "labelColor": {
            "def": "#154273", /* Logius Blue */
            "wv": "#39870c",
            "cv": "#000000",
            "vv": "#000000"
        },
        "licenses": {
            "cc0": {
            "name": "Creative Commons 0 Public Domain Dedication",
            "short": "CC0",
            "url": "https://creativecommons.org/publicdomain/zero/1.0/",
            "image": "https://gitdocumentatie.logius.nl/publicatie/respec/media/logos/cc-zero.svg"
            },
            "cc-by": {
            "name": "Creative Commons Attribution 4.0 International Public License",
            "short": "CC-BY",
            "url": "https://creativecommons.org/licenses/by/4.0/legalcode",
            "image": "https://gitdocumentatie.logius.nl/publicatie/respec/media/logos/cc-by.svg"
            },
            "cc-by-nd": {
            "name": "Creative Commons Naamsvermelding-GeenAfgeleideWerken 4.0 Internationaal",
            "short": "CC-BY-ND",
            "url": "https://creativecommons.org/licenses/by-nd/4.0/legalcode.nl",
            "image": "https://gitdocumentatie.logius.nl/publicatie/respec/media/logos/cc-by-nd.svg"
            }
        },
        "localBiblio": {
            /* Bibliography entries omitted for brevity */
            "ADR": {}, "ADR-ext": {}, "Algemene Voorwaarden Logius": {}, "AVG": {}, "BCP195": {}, "DK-beveiliging": {}, "CloudEvents": {}, "NLGOV-CloudEvents": {}, "DK-CV": {}, "DK-Portaal": {}, "DK-WUS-voorbeeld": {}, "Deployment Guide 1.1": {}, "DK": {}, "DK-Doc": {}, "DK-Beheermodel": {}, "DK-BPebMS": {}, "DK-BPGB": {}, "DK-BPWUS": {}, "DK-Beveiliging": {}, "DK-gbachtcert": {}, "DK-ebMS": {}, "DK-GB": {}, "DK-WUS": {}, "DK-RESTAPI": {}, "DK-Architectuur": {}, "DK-IDAuth": {}, "DK-WI": {}, "BOMOSFundament": {}, "BOMOSVerdieping": {}, "ebCPP": {}, "ebMS3": {}, "eDelivery API4IPS": {}, "Expert": {}, "folmer2011": {}, "folmer2012": {}, "DK-Gebruiksvoorwaarden": {}, "ADR-GEO": {}, "HTTPS-factsheet NCSC": {}, "iGOV.OpenID": {}, "NLGOV.OpenID": {}, "Introspection": {}, "JWA": {}, "JWE": {}, "JWK": {}, "JWS": {}, "JWT": {}, "NCSC 2019": {}, "NCSC 2021": {}, "NEN3610": {}, "no-Reliable-messaging": {}, "OAuth2": {}, "OpenID.Core": {}, "OpenID.Discovery": {}, "Pas-toe-of-leg-uit": {}, "PKIO-PvE": {}, "PKI-CA": {}, "PKIoverheid": {}, "PKIO-Cert": {}, "SemVer": {}, "ADR-TS": {}, "UMMR10": {}, "UMMUG": {}, "UUID": {}, "DK-Voorwaarden": {}, "X520": {}, "ADR-Validator": {}, "JRC117836": {}, "Krechmer2002": {}, "FSC-Core": {}, "FSC-Logging": {}
        },
        "alternateFormats": [
            {
            "label": "pdf",
            "uri": "API-Design-Rules.pdf"
            }
        ],
        "authors": [
            {
            "company": "Het Kadaster",
            "companyURL": "https://www.kadaster.nl",
            "name": "Jasper Roes"
            },
            {
            "company": "Het Kadaster",
            "companyURL": "https://www.kadaster.nl",
            "name": "Joost Farla"
            }
        ],
        "editors": [
            {
            "company": "Geonovum",
            "companyURL": "https://www.geonovum.nl",
            "name": "Frank Terpstra"
            },
            {
            "company": "Geonovum",
            "companyURL": "https://www.geonovum.nl",
            "name": "Jan van Gelder"
            },
            {
            "company": "Logius",
            "companyURL": "https://www.logius.nl",
            "name": "Alexander Green"
            },
            {
            "company": "Logius",
            "companyURL": "https://www.logius.nl",
            "name": "Martin van der Plas"
            }
        ],
        "github": "https://github.com/Logius-standaarden/API-Design-Rules",
        "pubDomain": "api",
        "publishDate": "2025-02-17",
        "publishVersion": "2.0.2",
        "previousPublishDate": "2025-01-07",
        "previousPublishVersion": "2.0.1",
        "shortName": "adr",
        "specStatus": "def",
        "specType": "ST",
        "pluralize": true
    }</script>
    <link rel="stylesheet" href="https://gitdocumentatie.logius.nl/publicatie/respec/style/base.css">

    <!-- START: Chat Sidebar CSS -->
    <style>
        /* Chat Sidebar Styles - Improved according to Dutch Government Design Standards */
        #chat-toggle-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            /* Use primary color from Dutch Government Style (Logius Blue) */
            background-color: #154273;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            line-height: 50px;
            text-align: center;
            cursor: pointer;
            z-index: 1001; /* Above sidebar */
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s ease-in-out;
        }

        #chat-toggle-button:hover {
            transform: scale(1.1);
            background-color: #103154; /* Slightly darker shade on hover */
        }

        #chat-sidebar {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 750px; /* Maintain specified width */
            max-width: 90vw; /* Prevent excessive width on smaller screens */
            background-color: #ffffff; /* White background */
            box-shadow: -3px 0 6px rgba(0,0,0,0.1);
            transform: translateX(100%); /* Initially hidden */
            transition: transform 0.3s ease-in-out;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            border-left: 1px solid #d1d1d1; /* Standard light border color */
            font-family: inherit; /* Inherit main document font */
        }

        #chat-sidebar.is-open {
            transform: translateX(0);
        }

        #chat-header {
            padding: 10px 15px;
            background-color: #f5f5f5; /* Standard light grey header */
            border-bottom: 1px solid #d1d1d1;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #333333; /* Dark grey text for readability */
        }

        #chat-close-button {
            background: none;
            border: none;
            font-size: 24px; /* Larger for easier clicking */
            cursor: pointer;
            padding: 0 5px;
            color: #555555; /* Grey color for close icon */
        }
         #chat-close-button:hover {
             color: #000000; /* Darken on hover */
         }

        #chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            background-color: #fff;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            padding: 10px 14px; /* Slightly more padding */
            border-radius: 6px; /* Standard border-radius */
            max-width: 85%;
            word-wrap: break-word;
            line-height: 1.5; /* Improved line spacing */
            font-size: 0.95em; /* Consistent font size */
        }

        .user-message {
            /* Lighter blue, consistent with government palettes */
            background-color: #e6f2ff; /* Light blue */
            color: #154273; /* Dark blue text for contrast */
            align-self: flex-end;
            border-bottom-right-radius: 0;
        }

        .assistant-message {
            background-color: #f5f5f5; /* Consistent light grey */
            color: #333333; /* Dark grey text */
            align-self: flex-start;
            border-bottom-left-radius: 0;
        }

        .error-message {
            background-color: #f8d7da; /* Standard error red */
            color: #721c24; /* Standard error text color */
            align-self: center;
            width: 90%;
            text-align: center;
            font-style: italic;
            border: 1px solid #f5c6cb;
        }

        #chat-input-area {
            display: flex;
            padding: 10px;
            border-top: 1px solid #d1d1d1;
            background-color: #f5f5f5; /* Match header/assistant message */
        }

        #chat-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #cccccc; /* Standard input border */
            border-radius: 4px; /* Standard input radius */
            margin-right: 5px;
            resize: none;
            min-height: 40px;
            max-height: 120px;
            overflow-y: auto;
            box-sizing: border-box;
            font-family: inherit; /* Inherit font */
            font-size: 1em;
        }
         #chat-input:focus {
            outline: none;
            border-color: #154273; /* Highlight with primary color */
            box-shadow: 0 0 0 1px #154273;
         }

        #chat-send-button { /* Optional send button */
            padding: 0 15px; /* Adjust padding for better vertical alignment */
            height: 40px; /* Match input height */
            background-color: #154273; /* Use primary color */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            line-height: 40px; /* Center text */
        }
        #chat-send-button:hover {
            background-color: #103154; /* Darker shade on hover */
        }
        #chat-send-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }


        /* Spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #154273; /* Use primary blue for spinner */
            border-radius: 50%;
            width: 24px; /* Slightly larger */
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 10px auto;
            align-self: center;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- Sources Popup Styles (Aligned with Theme) --- */
        .popup-overlay {
            position: fixed; /* Changed to fixed for full viewport overlay */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1005; /* Ensure it's above chat sidebar */
            padding: 20px; /* Padding around the content */
            box-sizing: border-box;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s linear 0.3s;
        }

        .popup-overlay.visible {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s ease, visibility 0s linear 0s;
        }

        .popup-content {
            background-color: #fff;
            padding: 25px; /* More padding */
            border-radius: 6px; /* Consistent radius */
            max-width: 700px; /* Limit width */
            width: 90%;
            max-height: 85vh; /* Use viewport height */
            overflow-y: auto;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            color: #333333;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }

        .popup-overlay.visible .popup-content {
             transform: scale(1);
        }

        .popup-content h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #154273; /* Primary blue heading */
            border-bottom: 2px solid #154273; /* Use primary color for border */
            padding-bottom: 10px;
            font-size: 1.3em;
        }

        #sources-popup-close {
            position: absolute;
            top: 15px; /* Adjust position */
            right: 15px;
            background: none;
            border: none;
            font-size: 28px; /* Larger close icon */
            line-height: 1;
            cursor: pointer;
            color: #888;
            padding: 5px;
        }
         #sources-popup-close:hover {
            color: #333;
         }

        #sources-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #sources-list li {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eeeeee; /* Lighter border */
        }
         #sources-list li:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
         }

        #sources-list span {
            display: block;
            font-size: 0.9em;
            margin-bottom: 5px;
            color: #555555;
        }
        #sources-list span strong {
            color: #333333;
            margin-right: 5px;
        }

        #sources-list a {
            color: #154273; /* Use primary blue for links */
            text-decoration: none;
            word-break: break-all;
            border-bottom: 1px dotted #154273; /* Subtle underline */
        }
        #sources-list a:hover {
            text-decoration: none;
            border-bottom: 1px solid #154273; /* Solid underline on hover */
        }

        /* Button to trigger the popup */
        .view-sources-button {
            display: inline-block; /* Make it inline block */
            margin-top: 10px;
            margin-left: auto; /* Align to right below message */
            padding: 6px 12px; /* Standard button padding */
            font-size: 0.8em;
            background-color: #e9ecef;
            color: #343a40;
            border: 1px solid #ced4da;
            border-radius: 4px; /* Standard radius */
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
            font-weight: 600; /* Slightly bolder */
            text-transform: uppercase; /* Uppercase text */
            letter-spacing: 0.5px;
        }
        .view-sources-button:hover {
            background-color: #d6dce1;
            border-color: #b6bec6;
        }

         /* --- AI Disclaimer Styles (Inside Sidebar) --- */
        #chat-disclaimer {
            font-size: 0.75em; /* Even smaller inside chat */
            color: #6c757d;
            text-align: center;
            padding: 8px 10px; /* Less padding */
            border-top: 1px solid #d1d1d1; /* Match input area border */
            background-color: #f5f5f5; /* Match input area background */
            line-height: 1.3;
            margin-top: auto; /* Pushes to bottom if sidebar had extra space, but flex handles it */
        }
         #chat-disclaimer p {
             margin: 0 0 4px 0; /* Small space between lines */
         }
         #chat-disclaimer p:last-child {
             margin-bottom: 0;
         }

    </style>
    <!-- END: Chat Sidebar CSS -->

</head>

<body class="h-entry toc-inline">
    <div class="head">
        <a class="logo" href="https://www.logius.nl/onze-dienstverlening/standaarden"><img alt="Logius" height="77" id="Logius" src="https://gitdocumentatie.logius.nl/publicatie/respec/style/logos/figure-logius.svg" width="44">
      </a> <h1 id="title" class="title">NLGov REST API Design Rules 2.0.2</h1>

        <h2>
          Logius Standard<br>
          Definitive version
          <time class="dt-published" datetime="2025-02-17">February 17, 2025</time>
        </h2>
        <dl>
          <dt>This version:</dt><dd class="status">
                  <a class="u-url status" href="https://gitdocumentatie.logius.nl/publicatie/api/adr/2.0.2/">https://gitdocumentatie.logius.nl/publicatie/api/adr/2.0.2/</a>
                </dd>
          <dt>Latest published version:</dt><dd>
                  <a href="https://gitdocumentatie.logius.nl/publicatie/api/adr/">https://gitdocumentatie.logius.nl/publicatie/api/adr/</a>
                </dd>
          <dt>Latest editor's draft:</dt><dd><a href="https://logius-standaarden.github.io/API-Design-Rules/">https://logius-standaarden.github.io/API-Design-Rules/</a></dd>



          <dt>Previous version:</dt><dd><a href="https://gitdocumentatie.logius.nl/publicatie/api/adr/2.0.1/">https://gitdocumentatie.logius.nl/publicatie/api/adr/2.0.1/</a></dd>

          <dt>Editors:</dt>
          <dd class="editor p-author h-card vcard">
        <span class="p-name fn">Frank Terpstra</span> (<a class="p-org org h-org" href="https://www.geonovum.nl">Geonovum</a>)
      </dd><dd class="editor p-author h-card vcard">
        <span class="p-name fn">Jan van Gelder</span> (<a class="p-org org h-org" href="https://www.geonovum.nl">Geonovum</a>)
      </dd><dd class="editor p-author h-card vcard">
        <span class="p-name fn">Alexander Green</span> (<a class="p-org org h-org" href="https://www.logius.nl">Logius</a>)
      </dd><dd class="editor p-author h-card vcard">
        <span class="p-name fn">Martin van der Plas</span> (<a class="p-org org h-org" href="https://www.logius.nl">Logius</a>)
      </dd>

          <dt>Authors:</dt><dd class="editor p-author h-card vcard">
        <span class="p-name fn">Jasper Roes</span> (<a class="p-org org h-org" href="https://www.kadaster.nl">Het Kadaster</a>)
      </dd><dd class="editor p-author h-card vcard">
        <span class="p-name fn">Joost Farla</span> (<a class="p-org org h-org" href="https://www.kadaster.nl">Het Kadaster</a>)
      </dd>
          <dt>Participate:</dt><dd>
        <a href="https://github.com/Logius-standaarden/API-Design-Rules/">GitHub Logius-standaarden/API-Design-Rules</a>
      </dd><dd>
        <a href="https://github.com/Logius-standaarden/API-Design-Rules/issues/">File an issue</a>
      </dd><dd>
        <a href="https://github.com/Logius-standaarden/API-Design-Rules/commits/">Commit history</a>
      </dd><dd>
        <a href="https://github.com/Logius-standaarden/API-Design-Rules/pulls/">Pull requests</a>
      </dd>
        </dl>


        <p>
              This document is also available in these non-normative format:
              <a rel="alternate" href="API-Design-Rules.pdf">pdf</a>
            </p>
        <p class="copyright">
                This document is licensed under
                <a rel="license" href="https://creativecommons.org/licenses/by/4.0/legalcode" class="subfoot"><img class="license" src="https://gitdocumentatie.logius.nl/publicatie/respec/media/logos/cc-by.svg" alt="Logo Creative Commons Attribution 4.0 International Public License"><br> Creative Commons Attribution 4.0 International Public License</a>
              </p>
        <hr title="Separator for header">
      </div>
    <section id="abstract" class="introductory"><h2>Abstract</h2><p>This document contains a normative standard for designing APIs in the Dutch Public Sector.
        <a href="https://gitdocumentatie.logius.nl/publicatie/api/beheermodel/">The Governance of this standard</a> is described by the API-Standaarden beheermodel in a <a href="https://github.com/Logius-standaarden/API-Standaarden-Beheermodel/">separate repository</a> and published by Logius.
        This document is part of the <em>Nederlandse API Strategie</em>, which consists of <a href="https://www.geonovum.nl/themas/kennisplatform-apis#APIStrategie">a set of documents</a>.</p>
    </section>
    <section class="notoc" id="conformance"><div class="header-wrapper"><h2 id="conformance-0">Conformance</h2><a class="self-link" href="#conformance" aria-label="Permalink for this Section"></a></div><p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.</p><p>
            The key words <em class="rfc2119">MAY</em>, <em class="rfc2119">MUST</em>, <em class="rfc2119">MUST NOT</em>, and <em class="rfc2119">SHOULD</em> in this document
            are to be interpreted as described in
            <a href="https://datatracker.ietf.org/doc/html/bcp14">BCP 14</a>
            [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>] [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8174" title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>]
            when, and only when, they appear in all capitals, as shown here.
        </p>
    </section>
    <section id="sotd" class="introductory"><h2>Status of This Document</h2><p>This is the definitive version of this document. Edits resulting from consultations have been applied.</p></section>
    <nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#abstract">Abstract</a></li><li class="tocline"><a class="tocxref" href="#sotd">Status of This Document</a></li><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>Introduction</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#goal"><bdi class="secno">1.1 </bdi>Goal</a></li><li class="tocline"><a class="tocxref" href="#status"><bdi class="secno">1.2 </bdi>Status</a></li><li class="tocline"><a class="tocxref" href="#authors"><bdi class="secno">1.3 </bdi>Authors</a></li><li class="tocline"><a class="tocxref" href="#reading-guide"><bdi class="secno">1.4 </bdi>Reading Guide</a></li><li class="tocline"><a class="tocxref" href="#extensions"><bdi class="secno">1.5 </bdi>Extensions</a></li></ol></li><li class="tocline"><a class="tocxref" href="#summary"><bdi class="secno">2. </bdi>Summary</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normative-design-rules"><bdi class="secno">2.1 </bdi>Normative Design Rules</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#list-of-functional-rules"><bdi class="secno">2.1.1 </bdi>List of functional rules</a></li><li class="tocline"><a class="tocxref" href="#list-of-technical-rules"><bdi class="secno">2.1.2 </bdi>List of technical rules</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#the-core-set-of-design-rules"><bdi class="secno">3. </bdi>The core set of Design Rules</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#resources"><bdi class="secno">3.1 </bdi>Resources</a></li><li class="tocline"><a class="tocxref" href="#http-methods"><bdi class="secno">3.2 </bdi>HTTP methods</a></li><li class="tocline"><a class="tocxref" href="#statelessness"><bdi class="secno">3.3 </bdi>Statelessness</a></li><li class="tocline"><a class="tocxref" href="#relationships"><bdi class="secno">3.4 </bdi>Relationships</a></li><li class="tocline"><a class="tocxref" href="#operations"><bdi class="secno">3.5 </bdi>Operations</a></li><li class="tocline"><a class="tocxref" href="#documentation"><bdi class="secno">3.6 </bdi>Documentation</a></li><li class="tocline"><a class="tocxref" href="#versioning"><bdi class="secno">3.7 </bdi>Versioning</a></li><li class="tocline"><a class="tocxref" href="#transport-security"><bdi class="secno">3.8 </bdi>Transport Security</a></li><li class="tocline"><a class="tocxref" href="#geospatial"><bdi class="secno">3.9 </bdi>Geospatial</a></li></ol></li><li class="tocline"><a class="tocxref" href="#glossary"><bdi class="secno">4. </bdi>Glossary</a></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">A. </bdi>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">A.1 </bdi>Normative references</a></li><li class="tocline"><a class="tocxref" href="#informative-references"><bdi class="secno">A.2 </bdi>Informative references</a></li></ol></li></ol></nav>
    <div>
        <!-- Status table omitted for brevity -->
    </div>

    <section class="informative" id="introduction"><div class="header-wrapper"><h2 id="x1-introduction"><bdi class="secno">1. </bdi>Introduction</h2><a class="self-link" href="#introduction" aria-label="Permalink for Section 1."></a></div><p><em>This section is non-normative.</em></p>
        <section id="goal"><div class="header-wrapper"><h3 id="x1-1-goal"><bdi class="secno">1.1 </bdi>Goal</h3><a class="self-link" href="#goal" aria-label="Permalink for Section 1.1"></a></div>
        <p>More and more governmental organizations offer REST APIs (henceforth abbreviated as APIs), in addition to existing interfaces like SOAP and WFS. These APIs aim to be developer-friendly and easy to implement. While this is a commendable aim, it does not shield a developer from a steep learning curve getting to know every new API, in particular when every individual API is designed using different patterns and conventions.</p>
        <p>This document aims to describe a widely applicable set of design rules for the unambiguous provisioning of REST APIs. The primary goal is to offer guidance for organizations designing new APIs, with the purpose of increasing developer experience (DX) and interoperability between APIs. Hopefully, many organizations will adopt these design rules in their corporate API strategies and provide feedback about exceptions and additions to subsequently improve these design rules.</p>
        </section><section id="status"><div class="header-wrapper"><h3 id="x1-2-status"><bdi class="secno">1.2 </bdi>Status</h3><a class="self-link" href="#status" aria-label="Permalink for Section 1.2"></a></div>
        <p>This version of the design rules has been submitted to Forum Standaardisatie for inclusion on the Comply or Explain list of mandatory standards in the Dutch Public Sector. This document originates from the document <a href="https://docs.geostandaarden.nl/api/vv-hr-API-Strategie-20190715/">API Strategie voor de Nederlandse Overheid</a>, which was recently split into separate sub-documents.</p>
        </section><section id="authors"><div class="header-wrapper"><h3 id="x1-3-authors"><bdi class="secno">1.3 </bdi>Authors</h3><a class="self-link" href="#authors" aria-label="Permalink for Section 1.3"></a></div>
        <p>Despite the fact that two authors are mentioned in the list of authors, this document is the result of a collaborative effort by the members of the <em>API Design Rules Working Group</em>.</p>
        </section><section id="reading-guide"><div class="header-wrapper"><h3 id="x1-4-reading-guide"><bdi class="secno">1.4 </bdi>Reading Guide</h3><a class="self-link" href="#reading-guide" aria-label="Permalink for Section 1.4"></a></div>
        <p>This document is part of the <em>Nederlandse API Strategie</em>.</p>
        <p>The Nederlandse API Strategie consists of <a href="https://www.geonovum.nl/themas/kennisplatform-apis#APIStrategie">a set of distinct documents</a>.</p>
        <!-- Table of NL API Strategie docs omitted for brevity -->
        <p>Before reading this document it is advised to gain knowledge of the informative documents, in particular the <a href="https://geonovum.github.io/KP-APIs/API-strategie-algemeen/Architectuur/">Architecture</a>.</p>
        <p>An overview of all current documents is available in this Dutch infographic:</p>
        <figure id="fig-nl-api-strategie-infographic">
        <object data="https://geonovum.github.io/KP-APIs/media/API_infographic.svg" type="image/svg+xml" id="infographic">NL API Strategie Infographic</object>
        <figcaption><a class="self-link" href="#fig-nl-api-strategie-infographic">Figure <bdi class="figno">1</bdi></a> <span class="fig-title">NL API Strategie Infographic</span></figcaption>
        </figure>

        </section><section id="extensions"><div class="header-wrapper"><h3 id="x1-5-extensions"><bdi class="secno">1.5 </bdi>Extensions</h3><a class="self-link" href="#extensions" aria-label="Permalink for Section 1.5"></a></div>
        <div class="note" role="note" id="issue-container-generatedID"><div role="heading" class="note-title marker" id="h-note" aria-level="4"><span>Note</span></div><aside class="">
        In addition to this (normative) document, separate modules are being written to provide a set of extensions. These modules are all separate documents and exists in a <a href="https://geonovum.github.io/KP-APIs/">latest editor's draft</a> (<i>Werkversie</i> in Dutch). The latest editor's draft is actively being worked on and can be found on <a href="https://github.com/Geonovum/KP-APIs">GitHub</a>. It contains the most recent changes.
        </aside></div></section>
    </section>
    <section id="summary"><div class="header-wrapper"><h2 id="x2-summary"><bdi class="secno">2. </bdi>Summary</h2><a class="self-link" href="#summary" aria-label="Permalink for Section 2."></a></div>
        <section id="normative-design-rules"><div class="header-wrapper"><h3 id="x2-1-normative-design-rules"><bdi class="secno">2.1 </bdi>Normative Design Rules</h3><a class="self-link" href="#normative-design-rules" aria-label="Permalink for Section 2.1"></a></div>
        <p>Design rules can be technical rules, which should be tested automatically and functional rules which should be considerd when designing and building the api.</p>
        <section id="list-of-functional-rules"><div class="header-wrapper"><h4 id="x2-1-1-list-of-functional-rules"><bdi class="secno">2.1.1 </bdi>List of functional rules</h4><a class="self-link" href="#list-of-functional-rules" aria-label="Permalink for Section 2.1.1"></a></div>
         <!-- List omitted for brevity -->
        </section><section id="list-of-technical-rules"><div class="header-wrapper"><h4 id="x2-1-2-list-of-technical-rules"><bdi class="secno">2.1.2 </bdi>List of technical rules</h4><a class="self-link" href="#list-of-technical-rules" aria-label="Permalink for Section 2.1.2"></a></div>
         <!-- List omitted for brevity -->
        </section>
        </section>
    </section>
    <section id="the-core-set-of-design-rules"><div class="header-wrapper"><h2 id="x3-the-core-set-of-design-rules"><bdi class="secno">3. </bdi>The core set of Design Rules</h2><a class="self-link" href="#the-core-set-of-design-rules" aria-label="Permalink for Section 3."></a></div>
        <!-- Sections 3.1 to 3.9 content omitted for brevity, keep the structure if needed -->
        <section id="resources"><div class="header-wrapper"><h3 id="x3-1-resources"><bdi class="secno">3.1 </bdi>Resources</h3><a class="self-link" href="#resources" aria-label="Permalink for Section 3.1"></a></div>...</section>
        <section id="http-methods"><div class="header-wrapper"><h3 id="x3-2-http-methods"><bdi class="secno">3.2 </bdi>HTTP methods</h3><a class="self-link" href="#http-methods" aria-label="Permalink for Section 3.2"></a></div>...</section>
        <section id="statelessness"><div class="header-wrapper"><h3 id="x3-3-statelessness"><bdi class="secno">3.3 </bdi>Statelessness</h3><a class="self-link" href="#statelessness" aria-label="Permalink for Section 3.3"></a></div>...</section>
        <section id="relationships"><div class="header-wrapper"><h3 id="x3-4-relationships"><bdi class="secno">3.4 </bdi>Relationships</h3><a class="self-link" href="#relationships" aria-label="Permalink for Section 3.4"></a></div>...</section>
        <section id="operations"><div class="header-wrapper"><h3 id="x3-5-operations"><bdi class="secno">3.5 </bdi>Operations</h3><a class="self-link" href="#operations" aria-label="Permalink for Section 3.5"></a></div>...</section>
        <section id="documentation"><div class="header-wrapper"><h3 id="x3-6-documentation"><bdi class="secno">3.6 </bdi>Documentation</h3><a class="self-link" href="#documentation" aria-label="Permalink for Section 3.6"></a></div>...</section>
        <section id="versioning"><div class="header-wrapper"><h3 id="x3-7-versioning"><bdi class="secno">3.7 </bdi>Versioning</h3><a class="self-link" href="#versioning" aria-label="Permalink for Section 3.7"></a></div>...</section>
        <section id="transport-security"><div class="header-wrapper"><h3 id="x3-8-transport-security"><bdi class="secno">3.8 </bdi>Transport Security</h3><a class="self-link" href="#transport-security" aria-label="Permalink for Section 3.8"></a></div>...</section>
        <section id="geospatial"><div class="header-wrapper"><h3 id="x3-9-geospatial"><bdi class="secno">3.9 </bdi>Geospatial</h3><a class="self-link" href="#geospatial" aria-label="Permalink for Section 3.9"></a></div>...</section>
    </section>
    <section id="glossary"><div class="header-wrapper"><h2 id="x4-glossary"><bdi class="secno">4. </bdi>Glossary</h2><a class="self-link" href="#glossary" aria-label="Permalink for Section 4."></a></div>
       <!-- Glossary definitions omitted for brevity -->
    </section>


    <section id="references" class="appendix"><div class="header-wrapper"><h2 id="a-references"><bdi class="secno">A. </bdi>References</h2><a class="self-link" href="#references" aria-label="Permalink for Appendix A."></a></div>
        <section id="normative-references">
            <div class="header-wrapper"><h3 id="a-1-normative-references"><bdi class="secno">A.1 </bdi>Normative references</h3><a class="self-link" href="#normative-references" aria-label="Permalink for Appendix A.1"></a></div>
            <dl>
            <!-- Bibliography omitted for brevity -->
            </dl>
        </section><section id="informative-references">
            <div class="header-wrapper"><h3 id="a-2-informative-references"><bdi class="secno">A.2 </bdi>Informative references</h3><a class="self-link" href="#informative-references" aria-label="Permalink for Appendix A.2"></a></div>
             <dl>
             <!-- Bibliography omitted for brevity -->
             </dl>
        </section>
    </section>
    <p role="navigation" id="back-to-top">
        <a href="#title"><abbr title="Back to Top">â†‘</abbr></a>
    </p>
    <!-- DFN panels omitted for brevity -->
    {% verbatim %}
    <script id="respec-dfn-panel">(() => { /* Respec DFN Panel script omitted for brevity */ })()</script>
    {% endverbatim %}
    <div class="sidelabel">Logius Standard - Definitive version</div>
    <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>


    <!-- START: Chat Sidebar HTML -->
    <!-- Chat Toggle Button -->
    <button id="chat-toggle-button" aria-label="Open Chat">ðŸ’¬</button>

    <!-- Chat Sidebar -->
    <aside id="chat-sidebar" aria-hidden="true">
        <div id="chat-header">
            <span>Logius Standaarden Chatbot</span>
            <button id="chat-close-button" aria-label="Close Chat">Ã—</button>
        </div>
        <div id="chat-messages">
            <!-- Initial message -->
             <div class="message assistant-message">Stel hier uw vraag over de standaarden in dit document.</div>
        </div>
        <div id="chat-input-area">
            <textarea id="chat-input" placeholder="Typ uw vraag..." rows="1" aria-label="Chat input"></textarea>
            <!-- Optional: Add a send button if needed and enabled in JS -->
            <!-- <button id="chat-send-button" aria-label="Send message">Verstuur</button> -->
        </div>

        <!-- START: AI Disclaimer (Inside Sidebar) -->
        <div id="chat-disclaimer"> 
            <p>Deze antwoorden zijn gegenereerd door AI.</p>
            <p>Let op correctheid en double-check de bronnen.</p>
        </div>
        <!-- END: AI Disclaimer (Inside Sidebar) -->

        <!-- START: Sources Popup (Modal) -->
        <!-- Uses CSS class 'popup-overlay' and 'visible' for control -->
        <div id="sources-popup" class="popup-overlay" role="dialog" aria-modal="true" aria-labelledby="sources-popup-title">
            <div class="popup-content">
                <h3 id="sources-popup-title">Bronnen</h3>
                <ul id="sources-list">
                    <!-- Source items will be dynamically added here -->
                </ul>
                <button id="sources-popup-close" aria-label="Close Sources">Ã—</button>
            </div>
        </div>
        <!-- END: Sources Popup (Modal) -->

    </aside>
    <!-- END: Chat Sidebar HTML -->

    <!-- START: Chat Sidebar JavaScript -->
    <script>
    (function() {
        // --- DOM Elements ---
        const toggleButton = document.getElementById('chat-toggle-button');
        const sidebar = document.getElementById('chat-sidebar');
        const closeButton = document.getElementById('chat-close-button');
        const messagesContainer = document.getElementById('chat-messages');
        const inputField = document.getElementById('chat-input');
        const chatDisclaimer = document.getElementById('chat-disclaimer'); // Get disclaimer element
        // const sendButton = document.getElementById('chat-send-button'); // Uncomment if using send button

        // Sources Popup Elements
        const sourcesPopup = document.getElementById('sources-popup');
        const sourcesList = document.getElementById('sources-list');
        const sourcesPopupClose = document.getElementById('sources-popup-close');

        // --- State ---
        let isOpen = false;
        let chatId = null;
        let isLoading = false;
        let hasInteracted = false; // <-- New state variable

        // --- Configuration ---
        const API_BASE_URL = 'http://localhost:8000/api'; // Your backend API base URL

        // --- Helper Functions ---

        function getCookie(name) { // --- CSRF Token ---
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        const csrftoken = getCookie('csrftoken');

        function addMessageToChat(text, sender, docs = null) {
            hideLoader(); // Always hide loader when adding a real message

            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            messageElement.classList.add(sender === 'user' ? 'user-message' : sender === 'assistant' ? 'assistant-message' : 'error-message');

            // Basic Markdown-like replacements (bold, italics)
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
            // Convert newlines to <br> for HTML display
            messageElement.innerHTML = text.replace(/\n/g, '<br>');

            messagesContainer.appendChild(messageElement);

            // Add "View Sources" button if it's an assistant message with documents
            if (sender === 'assistant' && docs && docs.length > 0) {
                const viewSourcesButton = document.createElement('button');
                viewSourcesButton.textContent = 'Bekijk Bronnen (' + docs.length + ')';
                viewSourcesButton.classList.add('view-sources-button');
                // Store docs data directly on the button
                viewSourcesButton.setAttribute('data-sources', JSON.stringify(docs));
                // Place button slightly offset below the message
                 messageElement.insertAdjacentElement('afterend', viewSourcesButton);
            }

            // Scroll to the bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showLoader() {
            if (!messagesContainer.querySelector('.loader')) {
                const loader = document.createElement('div');
                loader.className = 'loader';
                loader.setAttribute('aria-label', 'Loading response'); // Accessibility
                messagesContainer.appendChild(loader);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }

        function hideLoader() {
            const loader = messagesContainer.querySelector('.loader');
            if (loader) {
                messagesContainer.removeChild(loader);
            }
        }

        function showSourcesPopup(docs) {
            sourcesList.innerHTML = ''; // Clear previous sources
            if (!docs || docs.length === 0) {
                sourcesList.innerHTML = '<li>Geen bronnen beschikbaar voor dit antwoord.</li>';
            } else {
                docs.forEach((doc, index) => {
                    const li = document.createElement('li');
                    const titleSpan = document.createElement('span');
                    // Use doc_tag or fallback to index
                    titleSpan.innerHTML = `<strong>Bron ${index + 1}:</strong> ${doc.doc_tag || 'Onbekend document'}`;

                    const urlSpan = document.createElement('span');
                    const urlLink = document.createElement('a');
                    // Use chunk_url if available, otherwise '#'
                    urlLink.href = doc.chunk_url || '#';
                    urlLink.textContent = doc.chunk_url ? `Link naar sectie` : 'Geen directe link beschikbaar';
                    if (doc.chunk_url) {
                         urlLink.target = '_blank'; // Open in new tab if it's a valid URL
                         urlLink.rel = 'noopener noreferrer';
                    } else {
                        urlLink.style.pointerEvents = 'none'; // Disable click if no URL
                        urlLink.style.color = '#6c757d';
                        urlLink.style.borderBottom = 'none';
                    }


                    urlSpan.innerHTML = '<strong>Url:</strong> ';
                    urlSpan.appendChild(urlLink);

                    li.appendChild(titleSpan);
                    li.appendChild(urlSpan);
                    sourcesList.appendChild(li);
                });
            }
            // Use class to show the popup
            sourcesPopup.classList.add('visible');
            // Focus the close button for accessibility
            sourcesPopupClose.focus();
        }

        function hideSourcesPopup() {
             sourcesPopup.classList.remove('visible');
             // Return focus to the element that opened the popup if possible, or the chat input
             // (Requires tracking the opener, simplified here to focus input)
             if (isOpen) {
                 inputField.focus();
             }
        }

        // --- API Interaction ---

        async function fetchChatSession() {
             if (isLoading) return;
            isLoading = true;
            console.log("Requesting new chat session...");
            // Optionally disable toggle button while fetching session
            // toggleButton.disabled = true;
            try {
                const response = await fetch(`${API_BASE_URL}/chat/session/`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json', 'X-CSRFToken': csrftoken },
                    body: JSON.stringify({}) // Empty body is fine if backend expects it
                });
                if (!response.ok) {
                     const errorData = await response.json().catch(() => ({ error: "Onbekende serverfout" }));
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                if (data.chat_id) {
                    chatId = data.chat_id;
                    console.log("Chat session started:", chatId);
                    return chatId;
                } else { throw new Error("Geen chat_id ontvangen."); }
            } catch (error) {
                console.error("Error fetching chat session:", error);
                addMessageToChat(`Fout bij starten chat: ${error.message}. Probeer opnieuw.`, 'error');
                chatId = null;
                return null;
            } finally {
                isLoading = false;
                 // toggleButton.disabled = false;
            }
        }

        async function sendMessage(message) {
             // Ensure chat session exists before sending
            if (!chatId) {
                 const newChatId = await fetchChatSession();
                 if (!newChatId) {
                    addMessageToChat("Chatsessie is niet actief. Probeer het opnieuw.", 'error');
                    return; // Stop if session couldn't be created
                 }
                 // If session created successfully, proceed with sending message
            }

            if (isLoading || !message) return; // Don't send empty messages

            // --- Show Disclaimer on First Interaction ---
            if (!hasInteracted) {
                hasInteracted = true;
                if (chatDisclaimer) {
                    chatDisclaimer.style.display = 'block';
                }
            }
            // --------------------------------------------

            isLoading = true;
            inputField.disabled = true;
            // if (sendButton) sendButton.disabled = true; // Disable send button if present

            addMessageToChat(message, 'user');
            inputField.value = ''; // Clear input field
            // Reset input height after sending
            inputField.style.height = 'auto';
            inputField.style.height = inputField.scrollHeight + 'px';

            showLoader(); // Show spinner while waiting

            try {
                const response = await fetch(`${API_BASE_URL}/chat/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrftoken },
                    body: JSON.stringify({ query: message, chat_id: chatId })
                });

                 // No need to hide loader here, addMessageToChat will do it

                if (!response.ok) {
                     const errorData = await response.json().catch(() => ({ error: "Onbekende serverfout" }));
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                if (data.response) {
                    // Pass documents array to addMessageToChat
                    addMessageToChat(data.response, 'assistant', data.docs || []);
                } else if (data.error) {
                    addMessageToChat(data.error, 'error');
                } else {
                     // Handle unexpected success response without 'response' or 'error'
                     addMessageToChat("Onverwacht antwoord van de server.", 'error');
                }
            } catch (error) {
                console.error("Error sending message:", error);
                hideLoader(); // Ensure loader is hidden on error
                addMessageToChat(`Fout: ${error.message || "Kon geen verbinding maken."}`, 'error');
            } finally {
                isLoading = false;
                inputField.disabled = false;
                // if (sendButton) sendButton.disabled = false; // Re-enable send button
                inputField.focus(); // Keep focus on input field
            }
        }

        // --- Event Handlers ---

        async function toggleChat() { // Handles sidebar open/close
             // Prevent toggling while session is being fetched initially
            if (isLoading && !isOpen && !chatId) return;

            if (isOpen) {
                sidebar.classList.remove('is-open');
                sidebar.setAttribute('aria-hidden', 'true');
                hideSourcesPopup(); // Also hide popup when sidebar closes
                isOpen = false;
                toggleButton.setAttribute('aria-label', 'Open Chat'); // Update accessibility label
            } else {
                // Ensure chat session exists before opening fully
                if (!chatId) {
                    const newChatId = await fetchChatSession();
                    if (!newChatId) return; // Don't open if session failed
                }
                sidebar.classList.add('is-open');
                sidebar.setAttribute('aria-hidden', 'false');
                isOpen = true;
                inputField.focus(); // Focus input when opened
                toggleButton.setAttribute('aria-label', 'Close Chat'); // Update accessibility label
            }
        }

        function handleInputKeypress(event) {
            // Send message on Enter, unless Shift is pressed (for newlines)
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault(); // Prevent newline in textarea
                const message = inputField.value.trim();
                if (message) { // Only send if message is not empty
                    sendMessage(message);
                }
            }
        }

        // Auto-resize textarea height based on content
        function handleInputInput() {
             inputField.style.height = 'auto'; // Temporarily shrink to calculate correct scrollHeight
             inputField.style.height = (inputField.scrollHeight) + 'px';
        }

        // --- Initialization ---
        toggleButton.addEventListener('click', toggleChat);
        closeButton.addEventListener('click', toggleChat);
        inputField.addEventListener('keypress', handleInputKeypress);
        inputField.addEventListener('input', handleInputInput);

        // Send button functionality (if uncommented)
        // if (sendButton) {
        //     sendButton.addEventListener('click', () => {
        //         const message = inputField.value.trim();
        //         if (message && !isLoading) {
        //             sendMessage(message);
        //         }
        //     });
        // }

        // --- Popup Close Listeners ---
        sourcesPopupClose.addEventListener('click', hideSourcesPopup);
        // Close popup if clicked outside the content area
        sourcesPopup.addEventListener('click', (event) => {
            if (event.target === sourcesPopup) { // Click was directly on the overlay
                hideSourcesPopup();
            }
        });
        // Close popup on Escape key press
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && sourcesPopup.classList.contains('visible')) {
                hideSourcesPopup();
            }
        });


        // --- Event Delegation for "View Sources" Button ---
        messagesContainer.addEventListener('click', (event) => {
            // Check if the clicked element is a view sources button
            if (event.target && event.target.classList.contains('view-sources-button')) {
                 const button = event.target;
                 try {
                     // Retrieve the stored JSON string and parse it
                    const sourcesData = JSON.parse(button.getAttribute('data-sources'));
                    showSourcesPopup(sourcesData);
                 } catch (e) {
                    console.error("Error parsing sources data from button attribute:", e);
                    // Optionally show an error to the user
                    alert("Kon bronnen niet laden.");
                 }
            }
        });


        // Close sidebar if user clicks outside of it (and not on toggle button or inside popup)
        document.addEventListener('click', (event) => {
             if (isOpen && !sidebar.contains(event.target) && !toggleButton.contains(event.target)) {
                 // Check if the click is outside the sources popup content as well
                 if (!event.target.closest('.popup-content')) {
                    // Added check: Do not close if clicking on ReSpec definition links/panels
                     if (!event.target.closest('.dfn-panel') && !event.target.closest('dfn, .index-term')) {
                         toggleChat();
                     }
                 }
            }
        });

         // Initial setup: Ensure sidebar & popup are hidden and aria attributes are correct
        sidebar.classList.remove('is-open');
        sidebar.setAttribute('aria-hidden', 'true');
        sourcesPopup.classList.remove('visible');
        toggleButton.setAttribute('aria-label', 'Open Chat');

    })(); // IIFE End
    </script>
    <!-- END: Chat Sidebar JavaScript -->

</body>
</html>